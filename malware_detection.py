import os
import yara
import logging

logging.basicConfig(
    filename='/home/aarshna/logs/malware_detection.log',  # Update to the correct path
    level=logging.DEBUG,
    format='%(asctime)s - %(levelname)s - %(message)s'
)

def scan_file(file_path):
    try:
        logging.info(f"Scanning file: {file_path}")
        
        # Load the YARA rules from the file
        rules = yara.compile(filepath='malware_rules.yar')  # Update the path to your YARA rule file
        
        # Scan the file for matches to the YARA rules
        matches = rules.match(file_path)
        
        # If there are any matches, log them
        if matches:
            logging.info(f"Malware detected in {file_path}: {matches}")
            print(f"Malware detected in {file_path}: {matches}")
        else:
            logging.info(f"No malware detected in {file_path}")
            print(f"No malware detected in {file_path}")
    
    except yara.Error as e:
        logging.error(f"YARA error: {e}")
        print(f"YARA error: {e}")

def scan_directory(directory_path):
    # Iterate over all files in the given directory
    for root, dirs, files in os.walk(directory_path):
        for file in files:
            file_path = os.path.join(root, file)
            scan_file(file_path)  # Scan each file in the directory

if __name__ == "__main__":
    # Example: logging and scanning directory
    directory_path = input("Enter the directory path to scan: ")
    logging.info(f"Starting to scan directory: {directory_path}")
    scan_directory(directory_path)  # Scan all files in the directory
